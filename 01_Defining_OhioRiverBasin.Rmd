---
title: "01_Defining_OhioRiverBasin"
output: html_document
date: "2022-10-13"
editor_options: 
  chunk_output_type: console
---



```{r}
#This file and code below is meant to explore the new AOI (Ohio River Basin) I will be working with and the data within it. What I want to address are how many lakes are there in this basin, how many flowlines are covered within the RiverSR dataset, how many samples are included in AquaSat, etc.  
```


```{r}
library(tidyverse)
library(nhdplusTools)
library(sf)
```


#What is the Ohio River Basin? What HUC IDs are included in the Ohio River Basin? How many lakes are there within this basin? Are there sub basins? What are those? 
```{r}

#The Ohio River is listed with a 2 digit HUC of 05, and has 14 subbasins -- HUC4s (0501 - 0514) -- each with a number of HUC8s:(these were pulled from https://water.usgs.gov/GIS/huc_name.html#Region05)

huc8 <- c('05010001', '05010002', '05010003', '05010004', '05010005', '05010006', '05010007', '05010008', '05010009', '05020001', '05020002', '05020003', '05020004', '05020005', '05020006', '05030101', '05030102', '05030103', '05030104', '05030105', '05030106', '05030201', '05030202', '05030203', '05030204', '05040001', '05040002', '05040003', '05040004', '05040005', '05040006', '05050001', '05050002', '05050003', '05050004', '05050005', '05050006', '05050007', '05050008', '05050009', '05060001', '05060002', '05060003', '05070101', '05070102', '05070201', '05070202' ,'05070203', '05070204', '05080001', '05080002', '05080003', '05090101', '05090102', '05090103', '05090104', '05090201', '05090202', '05090203', '05100101', '05100102', '05100201', '05100202', '05100203', '05100204', '05100205', '05110001', '05110002', '05110003', '05110004', '05110005', '05110006', '05120101', '05120102', '05120103', '05120104', '05120105', '05120106', '05120107', '05120108', '05120109', '05120110', '05120111', '05120112', '05120113', '05120114', '05120115', '05120201', '05120202', '05120203', '05120204', '05120205', '05120206', '05120207', '05120208', '05120209', '05130101', '05130102', '05130103', '05130104', '05130105', '05130106', '05130107', '05130108', '05130201', '05130202', '05130203', '05130204', '05130205','05130206 ', '05140101', '05140102', '05140103', '05140104', '05140201', '05140202', '05140203', '05140204', '05140205', '05140206') 

#Pull out huc8 watersheds from nhd

huc8_watersheds <- data.frame()

for (i in huc8) {
  appending <- get_huc8(id = i)
  huc8_watersheds = rbind(huc8_watersheds, appending)

}

ggplot(data = huc8_watersheds)+
  geom_sf() +
  labs(title = 'Ohio River Basin HUC8 Watersheds') +
  theme_bw()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())


```

#Pull out nhd waterbodies within the roi of the Ohio River Basin (huc8_watersheds)
```{r}

huc8_watersheds$huc8 <- as.character(huc8_watersheds$huc8)

OhioRiver_waterbodies <- data.frame() #same process as above

for (i in huc8) {
  roi <- huc8_watersheds %>%
    filter(huc8 == i)
    appending <- get_waterbodies(AOI = roi, id = NULL, t_srs = NULL, buffer = 0.5)
  OhioRiver_waterbodies = rbind(OhioRiver_waterbodies, appending)

}

OhioRiver_waterbodies <- OhioRiver_waterbodies %>%
  filter(ftype == 'LakePond' | ftype == 'Reservoir')

# 11,643 lakes / ponds in the Ohio River Watershed

#How many above 10 hectares? LimnoSat / HydroLakes threshold

OhioRiver_waterbodies %>%
  filter(areasqkm > .01)

#10143 Lakes and Ponds should be included in LimnoSat / Hydrolakes

ggplot(data = OhioRiver_waterbodies)+
  geom_sf(colour = 'blue') +
  labs(title = 'Waterbodies in Ohio River Basin') +
  theme_bw()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
```

#How about rivers that are included in RiverSR? NHD Flowlines? How big do they have to be to be included in RiverSR?
```{r}
?get_nhdplushr()

OhioRiver_flowlines <- data.frame()

for (i in huc8) {
  roi <- huc8_watersheds %>%
    filter(huc8 == i)
    appending <- get_nhdplus(AOI = roi, realization = "flowline")
  OhioRiver_flowlines = rbind(OhioRiver_flowlines, appending)

}

#Rivers in RiverSR have to be greater than (or equal to?) 60 m wide

#ATM I'm not sure how to find river width ?

#I guess I could load in RiverSR,  join nhd_flowlines to RiverSR to filter for all the rivers in RiverSR? 

comids <- read.csv("C:/Users/samsi/Desktop/COMID_ID.csv") #taken from RiverSF repository

OhioRiver_flowlines_60m <- OhioRiver_flowlines %>%
  filter(comid %in% comids$COMID)

ggplot()+
  geom_sf(data = huc8_watersheds, fill = NA, color = alpha("black", 0.2)) +
  geom_sf(data = OhioRiver_waterbodies, colour = 'black') +
  geom_sf(data = OhioRiver_flowlines_60m, colour = '#2166ac', size = 1.5) +
  labs(title = 'Lakes and Flowlines (> 60 m wide) included within the Ohio River Basin') +
  theme_bw()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

```

#Pull out AquaSat data over this aoi
```{r}
aquasat <- read.csv("C:/Users/samsi/Desktop/sr_wq_rs_join.csv")

aquasat <- st_as_sf(aquasat, coords = c('long', 'lat'), crs = 4326, remove = FALSE) %>%
   st_transform(st_crs(huc8_watersheds))

aquasat <- aquasat %>%
  drop_na(chl_a)

#Ok, I'm going to want all of the aquasat data taken within my aoi

aquasat.aoi <- data.frame()

#this takes awhile
for (i in huc8) {
  roi <- huc8_watersheds %>%
    filter(huc8 == i)
    appending <- st_join(roi, aquasat, join = st_intersects)
  aquasat.aoi = rbind(aquasat.aoi, appending)

}

#1866 obs between rivers and lakes in AquaSat in the Ohio River Basin

aquasat.aoi <- aquasat.aoi %>%
  st_drop_geometry()

#some 40 odd na's in here were screwing things up, don't know where those came from? might need to check i non that 
aquasat.aoi <- aquasat.aoi %>% 
  drop_na(c('long','lat'))

aquasat.aoi <- st_as_sf(aquasat.aoi, coords = c('long', 'lat'), crs = 4326, remove = FALSE)

ggplot()+
  geom_sf(data = huc8_watersheds, fill = NA, color = alpha("black", 0.2)) +
  geom_sf(data = OhioRiver_waterbodies, colour = 'black') +
  geom_sf(data = OhioRiver_flowlines_60m, colour = '#2166ac', size = 1) +
  geom_sf(data = aquasat.aoi, colour = '#ca0020', size = 2) +
  labs(title = 'Lakes, Flowlines (> 60 m wide), and AquaSat obs included within the Ohio River Basin') +
  theme_bw()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

#how many unique sites in the aquasat aoi ? 

no.sites <- unique(aquasat.aoi$SiteID)

#536 sites over > 1800 obs , seems about right
```

